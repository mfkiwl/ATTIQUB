%%#######################################################################
% #######################################################################
% ###                                                                 ###
% ###  @@@@@@@@ @@@@@@@ @@@@@@@ @@@@@ @@@@@@@@@ @@@    @@@ @@@@@@@@   ###
% ###  @@@@@@@@ @@@@@@@ @@@@@@@ @@@@@ @@    (@@ @@@    @@@ @@@  @@@   ###
% ###  @@    @@   @@@     @@@    @@@  @@    (@@ @@@    @@@ @@@@@@@@@  ###
% ###  @@@@@@@@   @@@     @@@    @@@  @@@@@@@@@ @@@    @@@ @@@@@@@@@  ###
% ###  @@    @@   @@@     @@@   @@@@@ @@@@@@@@@ @@@@@@@@@@ @@@   @@@  ###
% ###  @@    @@   @@@     @@@   @@@@@     (@@@  @@@@@@@@@@ @@@@@@@@@  ###
% ###                                                                 ###
% ### Project ATTIQUB: Quarternions Toolbox                           ###
% ### Conversion of a quarternion into direction cosine matrix form   ###
% ###                                                                 ###
% ### By Samuel Low (13-12-2020), DSO National Laboratories           ###
% ###                                                                 ###
% #######################################################################
% #######################################################################

function [dcm] = qrt_conv2dcm(quarternion)

% Input is a 4x1 quarternion vector.
% Output is a 3x3 matrix DCM.

b0 = quarternion(1);
b1 = quarternion(2);
b2 = quarternion(3);
b3 = quarternion(4);

dcm = [(b0^2+b1^2-b2^2-b3^2) (2*(b1*b2+b0*b3))     (2*(b1*b3-b0*b2)) ;
       (2*(b1*b2-b0*b3))     (b0^2-b1^2+b2^2-b3^2) (2*(b2*b3+b0*b1)) ;
       (2*(b1*b3+b0*b2))     (2*(b2*b3-b0*b1))     (b0^2-b1^2-b2^2+b3^2)];

end